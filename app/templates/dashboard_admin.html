<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord Admin - BankCTF</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <nav>
            <div class="logo">üè¶ BankCTF</div>
            <ul>
                <li><a href="/dashboard">Tableau de bord</a></li>
                <li><a href="/logout" onclick="event.preventDefault(); if(confirm('D√©connexion?')) {fetch('/logout', {method: 'POST'}); window.location='/';}">D√©connexion</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="dashboard-section">
            <h1>Bienvenue, {{ username }}!</h1>
            <div class="admin-badge">üëë Administrateur</div>
            
            <div class="dashboard-content">
                <!-- Contacts Internes -->
                <div class="admin-section">
                    <h2>üìû Contacts Internes - Support Technique</h2>
                    <p class="info-text">En cas de probl√®me, contactez le service appropri√© :</p>
                    <table class="contacts-table">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Situation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>üîß IT / Informatique</td>
                                <td>Jean Admin</td>
                                <td>jean.admin@bank.ctf</td>
                                <td><span class="status-available">Disponible</span></td>
                            </tr>
                            <tr>
                                <td>üíº Ressources Humaines</td>
                                <td>Marie RH</td>
                                <td>marie.rh@bank.ctf</td>
                                <td><span class="status-available">Disponible</span></td>
                            </tr>
                            <tr>
                                <td>üí∞ Comptabilit√©</td>
                                <td>Pierre Comptable</td>
                                <td>pierre.comptable@bank.ctf</td>
                                <td><span class="status-available">Disponible</span></td>
                            </tr>
                            <tr>
                                <td>üîí S√©curit√©</td>
                                <td>Sophie S√©curit√©</td>
                                <td>sophie.securite@bank.ctf</td>
                                <td><span class="status-available">Disponible</span></td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="info-text-small">üí° Note: En cas de panne informatique, soucis avec un client, ou probl√®me de paie, contactez le service correspondant ci-dessus.</p>
                </div>

                <!-- Recherche Clients -->
                <div class="search-section">
                    <h2>üîç Recherche de clients</h2>
                    <p class="info-text">Recherchez un client par nom ou email dans la base de donn√©es.</p>
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="Entrez un nom ou email..." class="search-box">
                        <button onclick="searchUsers()" class="btn-primary">Rechercher</button>
                    </div>
                </div>

                <div id="search-results" class="results-container"></div>
                <div id="exec-results" class="exec-results"></div>
            </div>
        </section>
    </main>

    <script>
        function searchUsers() {
            const query = document.getElementById('search-input').value;
            const resultsDiv = document.getElementById('search-results');
            const execDiv = document.getElementById('exec-results');
            
            if (!query) {
                alert('Veuillez entrer une recherche');
                return;
            }

            resultsDiv.innerHTML = '<p>Recherche en cours...</p>';
            execDiv.innerHTML = '';

            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultsDiv.innerHTML = `<div class="error-message">${data.error}</div>`;
                    return;
                }

                if (data.exec_result) {
                    execDiv.innerHTML = `
                        <div class="exec-output">
                            <h3>R√©sultat de l'ex√©cution:</h3>
                            <pre>${data.exec_result}</pre>
                        </div>
                    `;
                }

                if (data.users && data.users.length > 0) {
                    let html = '<h3>R√©sultats de la recherche:</h3><table class="users-table"><thead><tr><th>ID</th><th>Username</th><th>Email</th><th>Role</th><th>Balance</th></tr></thead><tbody>';
                    data.users.forEach(user => {
                        html += `<tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.email || 'N/A'}</td>
                            <td>${user.role}</td>
                            <td>${user.balance ? user.balance.toFixed(2) + '‚Ç¨' : '0.00‚Ç¨'}</td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p>Aucun utilisateur trouv√©.</p>';
                }
            })
            .catch(error => {
                resultsDiv.innerHTML = `<div class="error-message">Erreur: ${error.message}</div>`;
            });
        }

        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchUsers();
            }
        });
    </script>
</body>
</html>


